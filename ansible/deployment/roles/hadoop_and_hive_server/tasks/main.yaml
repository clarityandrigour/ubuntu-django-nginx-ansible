---

# basic system tasks

- name: set locale to {{locale}}
  action: command /usr/sbin/update-locale LANG={{locale}} LC_ALL={{locale}}
  become: true

- name: get ubuntu packages for hadoop
  apt:
    name: ['build-essential', 'unzip', 'git', 'default-jdk']
    state: latest
    install_recommends: yes
    update_cache: yes
  become: true

- name: Make sure that we have a 'hadoop' group
  group:
    name=hadoop
    state=present

- name: Make sure that we have a 'wheel' group
  group:
    name=wheel
    state=present

- name: Make sure that vagrant user belongs to correct groups
  user:
    name: vagrant
    groups: wheel,hadoop
    append: yes

# Get Java ready for Hadoop

- name: Install add-apt-repostory
  become: yes
  apt: name=software-properties-common state=latest

- name: Add Oracle Java Repository
  become: yes
  apt_repository:
    repo: 'ppa:webupd8team/java'

- name: Accept Java 8 License
  become: yes
  debconf:
    name: 'oracle-java8-installer'
    question: 'shared/accepted-oracle-license-v1-1'
    value: 'true'
    vtype: 'select'

- name: Install Oracle Java 8
  become: yes
  apt:
    name: ['oracle-java8-installer', 'ca-certificates', 'oracle-java8-set-default']
    state: latest

- name: correct java version selected
  alternatives:
    name: java
    path: "{{java_version_for_alternatives}}"

- name: set JAVA_HOME variable
  lineinfile:
    path: /etc/environment
    insertafter: EOF
    line: 'JAVA_HOME="{{java_home}}"'


# download the Hadoop 3.1.1 directory

- name: get the Hadoop 3.1.1 code
  get_url:
    url: http://mirror.olnevhost.net/pub/apache/hadoop/common/hadoop-{{hadoop_version}}/hadoop-{{hadoop_version}}.tar.gz
    dest: /vagrant/resources/hadoop.tar.gz
    force: no
  become: true
  ignore_errors: yes
  register: hadoopdownloadexists
  when: hadoopdownloadexists is not defined

- name: unarchive the hadoop code
  unarchive:
    src: /vagrant/resources/hadoop.tar.gz
    dest: /vagrant/resources/src/hadoop
    group: hadoop
    remote_src: yes
  become: true
  when: hadoopdownloadexists




